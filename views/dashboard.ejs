<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Dashboard - Sasohae Admin</title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <link href="../public/css/styles.css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="../public/js/dashboard.js"></script>

        <style>
            body,
            button,
            input,
            textarea {
                font-family: 'Noto Sans KR', sans-serif;
            }
            td {
                font-size: medium;
            }
            .dataTable-sorter {
                text-align: center;
                font-size: medium;
            }
        </style>
    
    </head>
    <body class="sb-nav-fixed">
        <%- include ('layoutHeader') %>
            <!-- side bar start -->
            <div id="layoutSidenav"></div>
                <%- include ('layoutBody') %>
                <!-- side bar end -->


<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard - Sasohae Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
    <link href="../public/css/styles.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"
        crossorigin="anonymous"></script>
    <!--  jquery  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <style>
        body,
        button,
        input,
        textarea {
            font-family: 'Noto Sans KR', sans-serif;
        }

        td {
            font-size: medium;
        }

        .dataTable-sorter {
            text-align: center;
            font-size: medium;
        }
    </style>

</head>

<body class="sb-nav-fixed">
    <%- include ('layoutHeader') %>
        <!-- side bar start -->
        <div id="layoutSidenav"></div>
        <%- include ('layoutBody') %>
            <!-- side bar end -->
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid px-4">
                        <h1 class="mt-4">ÏÇ¨.ÏÜå.Ìï¥üìä ÎåÄÏãúÎ≥¥Îìú</h1>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item active">SASOHAE DASHBOARD</li>
                        </ol>
                        <div class="row">
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body">ÏÑ†Î¨ºÎ™©Î°ù ÏÑúÎπÑÏä§ Í¥ÄÎ¶¨</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-warning text-white mb-4">
                                    <div class="card-body">Î©îÎâ¥Î™©Î°ù ÏÑúÎπÑÏä§ Í¥ÄÎ¶¨</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-success text-white mb-4">
                                    <div class="card-body">Ï∂ïÏùòÍ∏à ÏÑúÎπÑÏä§ Í¥ÄÎ¶¨</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-danger text-white mb-4">
                                    <div class="card-body">Í≤åÏãúÌåê ÏÑúÎπÑÏä§ Í¥ÄÎ¶¨</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-1"></i>
                                        ÏùºÎ≥Ñ Î∞©Î¨∏Ïûê Ïàò
                                    </div>
                                    <div class="card-body"><canvas id="myBarChart" width="100%" height="40"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        ÏãúÍ∞ÑÎåÄÎ≥Ñ Î∞©Î¨∏Ïûê Ïàò
                                    </div>
                                    <div class="card-body"><canvas id="myAreaChart" width="100%" height="40"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-table me-1"></i>
                                DataTable Example
                            </div>
                            <div class="card-body">
                                <table id="datatablesSimple">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Office</th>
                                            <th>Age</th>
                                            <th>Start date</th>
                                            <th>Salary</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Office</th>
                                            <th>Age</th>
                                            <th>Start date</th>
                                            <th>Salary</th>
                                        </tr>
                                    </tfoot>
                                    <tbody>
                                        <tr>
                                            <td>Tiger Nixon</td>
                                            <td>System Architect</td>
                                            <td>Edinburgh</td>
                                            <td>61</td>
                                            <td>2011/04/25</td>
                                            <td>$320,800</td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
                <!-- footer start -->
                <footer>
                    <%- include ('layoutFooter') %>
                </footer>
                <!-- footer start -->
            </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                crossorigin="anonymous"></script>
            <script src="../public/js/scripts.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"
                crossorigin="anonymous"></script>
            <script>
                // Set new default font family and font color to mimic Bootstrap's default styling
                Chart.defaults.global.defaultFontFamily =
                    '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
                Chart.defaults.global.defaultFontColor = "#292b2c";

                $(document).ready(function () {
                    getAcessTime();
                });

                function getAcessTime() {
                    let userAccessPerDay = [];
                    let userAccessTime = [];
                    let temp = [];
                    $.ajax({
                        type: "GET",
                        url: "/api/user",
                        data: {},
                        success: function (response) {
                            let tempDate;
                            for (let i = 0; i < response.length; i++) {
                                tempDate = new Date(response[Object.keys(response)[i]].createdAt);
                                temp[i] = String(tempDate.toLocaleString()).split(' ');

                                userAccessPerDay[i] = temp[i].slice(0, 3);
                                userAccessTime[i] = temp[i].slice(3, 5);
                            }
                            makeDayChart(userAccessPerDay);
                            makeTimeChart(userAccessTime);
                        }
                    })
                }

                function makeDayChart(data) {
                    let info = data;
                    const firstMonth = info[0][1].slice(0, info[0][1].length - 1); // ÏùºÎã® 6Í∞úÏõîÏ†ïÎèÑ ÏÑúÎπÑÏä§ÏòàÏ†ïÏù¥ÎØÄÎ°ú Ïó∞ÎèÑÎäî Í≥†Î†§ x
                    const lastMonth = info[info.length - 1][1].slice(0, info[info.length - 1][1].length - 1);
                    const firstDay = info[0][2].slice(0, info[0][2].length - 1);
                    const lastDay = info[info.length - 1][2].slice(0, info[info.length - 1][2].length - 1);

                    let dayCnt = [];
                    
                    for (let i = 0; i <= lastMonth - firstMonth; i++) { // month
                        dayCnt[i] = [];
                        for (let j = 0; j < 31; j++) { // day
                            dayCnt[i][j] = 0;
                        }
                    }

                    for (let i = 0; i < info.length; i++) {
                        dayCnt[parseInt(info[i][1].slice(0, info[i][1].length - 1)) - 1][parseInt(info[i][2].slice(0, info[i][2].length - 1)) - 1]++;
                    }

                    console.log(dayCnt)
                    let serviceDay = [];
                    let visitorCnt = [];
                    
                    // for (let i = 0; i <) {
                    // }

                    const ctx = document.getElementById("myBarChart");
                    const myLineChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [],
                            datasets: [{
                                label: "Ï†ëÏÜçÏûê Ïàò",
                                backgroundColor: "rgba(2,117,216,1)",
                                borderColor: "rgba(2,117,216,1)",
                                data: [],
                            }],
                        },
                        options: {
                            scales: {
                                xAxes: [{
                                    time: {
                                        unit: 'day'
                                    },
                                    gridLines: {
                                        display: false
                                    },
                                    ticks: {
                                        maxTicksLimit: 6
                                    }
                                }],
                                yAxes: [{
                                    ticks: {
                                        min: 0,
                                        max: Math.max(...dayCnt), // ÏµúÎåÄÍ∞í
                                        maxTicksLimit: 5
                                    },
                                    gridLines: {
                                        display: true
                                    }
                                }],
                            },
                            legend: {
                                display: false
                            }
                        }
                    });
                }

                function makeTimeChart(info) {
                    let timeCnt = new Array(24).fill(0);
                    let tempTime = 0;

                    for (let i = 0; i < info.length; i++) {
                        tempTime = parseInt(info[i][1].split(':')[0]);
                        if (info[i][0] === "Ïò§ÌõÑ") {
                            tempTime += 12;
                            if (tempTime === 24) { // Î∞§12Ïãú
                                tempTime = 0;
                            }
                        }
                        timeCnt[tempTime]++;
                    }

                    const ctx = document.getElementById("myAreaChart");
                    const myLineChart = new Chart(ctx, {
                        type: "line",
                        data: {
                            labels: [
                                "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00",
                                "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00",
                            ],
                            datasets: [
                                {
                                    label: "Ï†ëÏÜçÏûê Ïàò",
                                    lineTension: 0.3,
                                    backgroundColor: "rgba(2,117,216,0.2)",
                                    borderColor: "rgba(2,117,216,1)",
                                    pointRadius: 5,
                                    pointBackgroundColor: "rgba(2,117,216,1)",
                                    pointBorderColor: "rgba(255,255,255,0.8)",
                                    pointHoverRadius: 5,
                                    pointHoverBackgroundColor: "rgba(2,117,216,1)",
                                    pointHitRadius: 50,
                                    pointBorderWidth: 2,
                                    data: timeCnt,
                                },
                            ],
                        },
                        options: {
                            scales: {
                                xAxes: [
                                    {
                                        time: {
                                            unit: "time",
                                        },
                                        gridLines: {
                                            display: false,
                                        },
                                        ticks: {
                                            maxTicksLimit: 7,
                                        },
                                    },
                                ],
                                yAxes: [
                                    {
                                        ticks: {
                                            min: 0,
                                            max: Math.max(...timeCnt), // ÏµúÎåÄÍ∞í
                                            maxTicksLimit: 5,
                                        },
                                        gridLines: {
                                            color: "rgba(0, 0, 0, .125)",
                                        },
                                    },
                                ],
                            },
                            legend: {
                                display: false,
                            },
                        },
                    });
                }

            </script>
            <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
            <script src="../public/js/datatables-simple-demo.js"></script>
</body>

</html>